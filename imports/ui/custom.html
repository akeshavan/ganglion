<template name="custom">
  <div class="container-fluid">
    <h1>Healthy Brain Network: Quality Control</h1>
    <p class="lead">Are you interested in studying pediatric mental health? Help us analyze the <a href="https://www.biorxiv.org/content/early/2017/06/13/149369">Healthy Brain Network dataset!</a></p>
    <p> We want to measure the volumes of various structures in the brain with
      automated algorithms (such as <a href="http://www.mindboggle.info/index.html"> Klein et al., 2017</a>, <a href="https://surfer.nmr.mgh.harvard.edu/">Fischl et al., 2002</a>, and <a href="http://stnava.github.io/ANTs/">Avants et al., 2014</a>).
      But some of the scans are very bad quality and would yield incorrect results. We need to identify these scans so we don't analyze them. </p>

    <p> To begin, sign the consent form and create an account: </p>

    <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
      <div class="panel panel-default">
        <div class="panel-heading" role="tab" id="headingConsent">
          <h4 class="panel-title" data-toggle="collapse" data-parent="#accordion" href="#collapseConsent">
            <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseConsent" aria-expanded="true" aria-controls="collapseConsent">
              1. {{#if getconsent}}View {{else}} Sign{{/if}} Consent Form
            </a>
            <div class="pull-right">
              {{#if getconsent}}
              <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
              {{else}}
              <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
              {{/if}}
            </div>
          </h4>

        </div>
        <div id="collapseConsent" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingConsent">
          <div class="panel-body">

            {{> consent}}

          </div>
        </div>
      </div>
    </div>

    <p> Next, read the instructions on how to view images and save your ratings: </p>

    <div class="panel-group" id="accordion1" role="tablist" aria-multiselectable="true">
      <div class="panel panel-default">
        <div class="panel-heading" role="tab" id="headingInstruction" data-toggle="collapse" data-parent="#accordion" href="#collapseInstruction">
          <h4 class="panel-title">
            <a role="button" data-toggle="collapse" data-parent="#accordion1" href="#collapseInstruction" aria-expanded="true" aria-controls="collapseInstruction">
              2. Instructions
            </a>

          </h4>

        </div>
        <div id="collapseInstruction" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingInstruction">
          <div class="panel-body">


                <div class="row vertical-align">
                    <!--
                        Using col-xs-* classes are recommended.
                        Otherwise you may run into a trouble.
                     -->
                    <div class="col-xs-6 col-md-6">
                        <img src="/selectionGIF.gif" width="100%"/>
                        <p class="center-block muted" style="text-align: center"><small>Figure 1: An animation showing how to open and image and adjust brightness/contrast</small></p>
                    </div>
                    <!--
                        Using col-xs-* classes are recommended.
                        Otherwise you may run into a trouble.
                     -->
                    <div class="col-xs-6 col-md-6">
                        <p class="lead center-block"> 1. Open an image  </p>
                        <p> Click on an image in the "Image File" column of the table below. After the image loads you can adjust the brightness and contrast by right clicking and dragging, or adjusting the colormap on the top left. </p>
                    </div>

                </div>

                <div class="row vertical-align">
                    <!--
                        Using col-xs-* classes are recommended.
                        Otherwise you may run into a trouble.
                     -->
                    <div class="col-xs-6 col-md-6">
                      <p class="lead center-block"> 2. Pass or Fail the image & rate your Confidence </p>
                      <p> In the "Save Changes" menu on the left side, click either "Pass" or "Fail". Then rate your confidence on a scale of 1 (low confidence) to 5 (high confidence). Write any observations in the "Notes" sections, and click "Save" when you are done. </p>
                    </div>
                    <!--
                        Using col-xs-* classes are recommended.
                        Otherwise you may run into a trouble.
                     -->
                    <div class="col-xs-6 col-md-6">
                        <img src="/QC_panel.png" width="50%" class="center-block"/>
                        <p class="center-block muted" style="text-align: center"><small>Figure 2: The QC menu panel</small></p>
                    </div>

                </div>




          </div>
        </div>
      </div>
    </div>

    <p> Follow these guidelines when you rate the images: </p>


    <div class="panel-group" id="accordion2" role="tablist" aria-multiselectable="true">
      <div class="panel panel-default">
        <div class="panel-heading" role="tab" id="headingGuidelines" data-toggle="collapse" data-parent="#accordion" href="#collapseGuidelines">
          <h4 class="panel-title">
            <a role="button" data-toggle="collapse" data-parent="#accordion2" href="#collapseGuidelines" aria-expanded="true" aria-controls="collapseGuidelines">
            3. Guidelines
          </a>
          </h4>

        </div>
        <div id="collapseGuidelines" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingGuidelines">
          <div class="panel-body">
            Here are some reasons a scan might fail quality control:

            <h3>Motion</h3>
            <p class="lead"> Scans with too much motion cannot be segmented </p>
            <p> The image below shows varying amounts of motion artifacts (you can see bands on the images). Images with too much motion cannot be automatically segmented because its too difficult to see the boundaries between tissues. </p>
            <img src="/motion_QC.png" width="100%"/>
            <p class="center-block muted" style="text-align: center"><small>Figure 3: Four images with varying levels on motion (banding artifacts). Image on the left has many artifacts, and it is difficult to delineate tissue types. The red arrow on the second image from the left shows the banding artifact to a lesser degree, and the green arrow on the third image from the left points to very minor banding artifacts. Motion guidelines are adapted from <a href="http://www.pnas.org/content/113/33/9357.full.pdf?with-ds=yes">(Walhovd et al., 2016)</a></small></p>

            <p> If you are not sure how to rate a scan with motion, give your rating a low confidence score (a 1 or 2). Don't worry if you are wrong, we will be averaging ratings across many raters.</p>

            <h3>Other Artifacts</h3>
            <p class="lead"> Shift + Click to annotate slices or regions of the image that are low quality </p>
            <p> Sometimes artifacts are only on a few slices. Annotate these slices so we know where they are:</p>
            <img src="/badQ.png" width="75%" class="center-block" />
            <p class="center-block muted" style="text-align: center"><small>Figure 4: Three examples showing images with artifacts only on a few slices. The image on the right shows a defacing error in the frontal lobe. The circle on the center image highlights an abnormally noisy region, and the image on the left is noisy throughout the whole image.</small></p>

            <p> The red dots on the image above show the annotations in regions of noise. Scroll through the entire brain when you QC, and watch out for bad defacing in the frontal lobes.</p>

            <h3>Abnormal Geometry</h3>
            <p class="lead"> Automated segmentation might fail on abnormal geometry </p>
            <p>The images below show brains with abnormal geometry, such as cysts or abnormally large ventricles. Automated segmentations might fail on these scans, so we need to be warned ahead of time.</p>
            <img src="/textAnnot.png" width="75%" class="center-block" />
            <p class="center-block muted" style="text-align: center"><small>Figure 5: Three examples of scans with good quality but abnormal geometry </small></p>

            <p> Pass the image if its quality is good, but remember to write a note (in the notes section) about any abnormal geometry or incidental findings. </p>

          </div>
        </div>
      </div>
    </div>

    Our goal is first finish rating all images with the <a class=" label label-warning filter T1w+average_vote+undefined">Not Rated</a> tag in the tables below.
     Click on the <a class=" label label-warning filter T1w+average_vote+undefined">Not Rated</a> tag to filter the table to only show scans that haven't been rated yet. As you rate, ask yourself, <strong> "Would you include this scan in your study for volumetric and cortical thickness analysis?"</strong>


     <div class="bs-callout bs-callout-default">
       <h4>Open Data</h4>
       We will release all QC results, and all subsequently computed metrics and images from this dataset (regional volumes, segmented images, surface meshes, etc).
     </div>

     <div class="bs-callout bs-callout-primary">
       <h4>Publications</h4>
       If you want to contribute to, or be included on, any publications that result from this collaborative QC process, please email Anisha Keshavan (anishakeshavan AT gmail DOT com) or message her on <a href="https://twitter.com/akeshavan_">twitter</a>
     </div>



  </div>

</template>

<template name="leaderboard">
  <div style="padding : 4px; width : 100%; height : 250px; overflow : auto; ">
    <table class="table table-striped table-hover table-responsive" style="width: auto;">
     <tr>
       <th class="header-table">Rank</th>
       <th class="header-table">Username</th>
       <th class="header-table">#</th>
     </tr>
     {{#each users}}
     <tr >
       <td class="item-table">{{idx}}</td>
       <td class="item-table">{{username}}</td>
       <td class="item-table">{{images}}</td>
     </tr>
     {{/each}}

   </table>
  </div>

</template>

<template name="consentModal">
  <div  id="consentModal" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
    <div class="modal-dialog modal-lg" role="document">
      <div class="modal-content">
        <div style="margin: 20px;">
          {{> consent}}
        </div>

      </div>
    </div>
  </div>
</template>

<template name="consent">
  <h4 style="text-align: center">
    UNIVERSITY OF WASHINGTON
    CONSENT FORM
  </h4>

  <h5 style="text-align: center">Crowdsourcing Image Segmentation</h5>
  <br>
  <h6>RESEARCHERS:</h6>
  <p>Anisha Keshavan<br>
  University of Washington eScience Institute and Institute for Neuroengineering<br>
  <a href="#">keshavan@uw.edu</a></p>

  <p>Jason Yeatman<br>
  University of Washington Institute for Neuroengineering<br>
  <a href="#">jdyeatman@uw.edu</a></p>

  <p>Ariel Rokem<br>
  University of Washington eScience Institute<br>
  <a href="#">arokem@uw.edu</a></p>

  <h6>RESEARCHER’S STATEMENT:</h6>
<p>  We are asking you to be in a research study.  The purpose of this consent form is to give you the information you will need to help you decide whether to be in the study or not.  Please read the form carefully.  You may ask questions about the purpose of the research, what we would ask you to do, the possible risks and benefits, your rights as a volunteer, and anything else about the research or this form that is not clear. Please email keshavan@uw.edu if you have any questions. When we have answered all your questions, you can decide if you want to be in the study or not.  This process is called “informed consent.”
</p>
  <h6>PURPOSE OF THE STUDY</h6>
  <p>Image annotation is needed to extract data from images. The purpose of this study is to train better computer algorithms to annotate images, and also correct any errors the computer makes. We aim to 1) collect image annotation data from you, and 2) combine annotations from many users into the most accurate annotation. This information will be used to train new computer algorithms.
    </p>
  <h6>STUDY PROCEDURES</h6>

  <p>You will be asked to log in. You may be given the option to use an existing social media login (e.g. Twitter, Facebook, Google, etc.), and you may be asked to create a an anonymous username to be displayed to the public. You may also choose to include your social media avatar to display alongside your anonymous username in the public leaderboard. Alternatively, you may also have the option to use an anonymous login. You may provide your email when you sign up for an account if you wish to be contacted about future work related to this task.</p>
  <p>You will be given instructions on how to annotate images for a particular task. Try your best to annotate the images as quickly and accurately as you can. You may complete however many tasks you wish. Each task can take anywhere from 30 seconds to 5 minutes. You may stop annotating at any time.
  </p>
  <p>You may use any device with a web browser (computer, tablet, or phone). We will record all settings you use on the application, your annotations, your screen resolution, and your anonymous username. This data will be made publically available to researchers.
  </p>
  <h6>RISKS, STRESS, OR DISCOMFORT</h6>
  <p>Some people feel that providing information for research or having the research session recorded is an invasion of privacy. If you wish to remain anonymous, we recommend creating an anonymous nickname that does not include any identifiers relating to you.
    </p>
  <h6>BENEFITS OF THE STUDY</h6>
  <p>This study will help us to extract accurate data from images. This information will be used for scientific research.
    </p>

  <h6>CONFIDENTIALITY OF RESEARCH INFORMATION</h6>
  <p>Your social media login information (such as username and email address), if provided, will remain confidential and will not be shared outside the study team.
  Government or university staff sometimes review studies such as this one to make sure they are being done safely and legally.  If a review of this study takes place, your records may be examined.  The reviewers will protect your privacy.  The study records will not be used to put you at legal risk of harm.
    </p>
  <h6>RESEARCH-RELATED INJURY</h6>
  <p>If you think you have been harmed from being in this research, contact Anisha Keshavan at <a href="#">keshavan@uw.edu.</a>
    </p>
  <p>* Please note that we cannot ensure the confidentiality of information sent via e-mail.
    </p>
  <h6>SUBJECT’S STATEMENT</h6>
  <p>This study has been explained to me, and I understand the procedures, benefits, and risks of this study.  I affirm that I am capable of consenting on my own behalf, that I am age 18 or older, and I volunteer to take part in this research.  I have had a chance to ask questions.  If I have questions later about the research, or if I have been harmed by participating in this study, I can contact one of the researchers listed on the first page of this consent form.  If I have questions about my rights as a research subject, I can call the Human Subjects Division at (206) 543-0098 or email hsdinfo@uw.edu.
    </p>
    <hr>
    <div style="text-align: center">
      {{#if getconsent}}
        You've consented!
        {{# if isLoggedIn}}
        Please <a onclick="document.getElementById('login-sign-in-link').click()" data-toggle="modal" data-target=".bs-example-modal-lg">sign in</a> to start.

        {{else}}
        <a href="#collapseConsent" data-toggle="collapse" data-parent="#accordion" onclick="window.scrollTo(0,0)"> Close </a>
        {{/if}}
      {{else}}
        <button id="consent" class="btn btn-primary" >
          I Consent
          &nbsp;
          <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
        </button>
      {{/if}}
    </div>
</template>
